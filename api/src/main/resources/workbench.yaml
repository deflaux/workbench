# This file is for endpoints we do NOT intend to generate client libraries for
# and advertise to notebook developers. Endpoints we DO want notebook developers to use should
# go in client_api.yaml.

# This file references parameters, paths, and definitions specified in
# client_api.yaml; the two files get merged together into a merged.yaml file at build time.

# If validation fails, gradle:generateApi fails claiming this file does not exist.
# For separate validation (with some false positives), do:
#     ./project.rb validate-swagger
swagger: '2.0'
info:
  version: "0.1.0"
  title: "AllOfUs Workbench API"
  description: "The API for the AllOfUs workbench."
  termsOfService: "http://www.pmi-ops.org/terms_of_service.html"
  contact:
    name: "developer_help@pmi-ops.org"
  license:
    name: "BSD"
host: "api.pmi-ops.org"
securityDefinitions:
  # Establish the fact that *some endpoints* are OAuth protected
  # by defining an `aou_oauth` security mode, which we'll assing
  # to any protected endpoints below.
  aou_oauth:
    # TODO: Vet/fix this token and/or authorization URL to work in practice.
    # These are currently included simply to satisfy the Swagger specification,
    # as this is not directly used to dictate oauth details (just used to
    # annotate which methods require oauth).
    authorizationUrl: ""
    tokenUrl: ""
    type: oauth2
    flow: accessCode
schemes:
  - "https"
produces:
  - "application/json"
# Establish the fact that all endpoints are protected: this annotation
# ensures that client libraries know to send bearer tokens when calling
security:
  - aou_oauth: []

# Throughout, we use integer/int64 in preference to string/date-time because Swagger's
# date formatting is inconsistent between server and client. Time values are stored as
# milliseconds since the UNIX epoch.

##########################################################################################
## PATHS
##########################################################################################

## Common Path Parameters
parameters:
  userId:
    in: path
    name: userId
    type: integer
    format: int64
    required: true
  conceptSetId:
    in: path
    name: conceptSetId
    type: integer
    format: int64
    required: true
    description: Concept set ID

paths:

  /v1/status:
    get:
      tags:
        - status
      description: Returns the status of the various services and integrations
      operationId: getStatus
      security: []
      responses:
        200:
          description: A map of system name to status.
          schema:
            $ref: "#/definitions/StatusResponse"


  /v1/config:
    get:
      tags:
        - config
      description: Returns some server configuration data.
      operationId: getConfig
      security: []
      responses:
        200:
          description: Configuration data
          schema:
            $ref: "#/definitions/ConfigResponse"


   # User methods ########################################################################

  /v1/me:
    get:
      tags:
        - profile
      description: Returns the user's profile information
      operationId: getMe
      responses:
        200:
          description: The user's profile.
          schema:
            $ref: "#/definitions/Profile"

  /v1/sendBugReport:
    post:
      tags:
        - bugReport
      consumes:
        - application/json
      description: Sends an email to developers about a user reported bug
      operationId: sendBugReport
      parameters:
        - in: body
          name: bugReport
          description: user reported bug
          required: true
          schema:
            $ref: "#/definitions/BugReport"
      responses:
        200:
          description: Success message
          schema:
            $ref: "#/definitions/BugReport"
        500:
          description: JIRA Internal Error

  # TODO(dmohs): If the username is not present in the query string, this responds with 500 Server
  # Error. It should respond with 400 Bad Request.
  /v1/is-username-taken:
    get:
      tags:
        - profile
      description: Checks to see if the given username is not available.
      operationId: isUsernameTaken
      security: []
      parameters:
        - in: query
          name: username
          type: string
          required: true
      responses:
        200:
          description: The answer.
          schema:
            $ref: "#/definitions/UsernameTakenResponse"

  /v1/is-contact-email-taken:
    get:
      tags:
        - profile
      description: Checks to see if the given contact email is not available.
      operationId: isContactEmailTaken
      security: []
      parameters:
        - in: query
          name: contactEmail
          type: string
          required: true
      responses:
        200:
          description: The answer.
          schema:
            $ref: "#/definitions/ContactEmailTakenResponse"

  /v1/update-contact-email:
    post:
      tags:
        - profile
      consumes:
        - application/json
      description: Only for accounts that have not logged in yet, update contact email.
      operationId: updateContactEmail
      security: []
      parameters:
        - in: body
          name: updateContactEmailRequest
          schema:
            $ref: "#/definitions/UpdateContactEmailRequest"
      responses:
        200:
          description: Contact Email Updated
        400:
          description: Invalid contact email address
        403:
          description: Unable to process this request
        500:
          description: Internal Server Error

  /v1/resend-welcome-email:
    post:
      tags:
        - profile
      consumes:
        - application/json
      description: Resend welcome email
      operationId: resendWelcomeEmail
      security: []
      parameters:
        - in: body
          name: resendWelcomeEmail
          schema:
            $ref: "#/definitions/ResendWelcomeEmailRequest"
      responses:
        200:
          description: Welcome Email sent.
        500:
          description: Internal Server Error

  /v1/invitation-key-verification:
    post:
      tags:
        - profile
      consumes:
        - application/json
      description: Verifies invitation key.
      operationId: invitationKeyVerification
      security: []
      parameters:
        - in: body
          name: invitationVerificationRequest
          schema:
            $ref: "#/definitions/InvitationVerificationRequest"
      responses:
        200:
          description: Invitation Key verified.
        400:
          description: Error occurred while verifying Invitation Key.
          schema:
            $ref: "#/definitions/ErrorResponse"

  /v1/google-account:
    post:
      tags:
        - profile
      consumes:
        - application/json
      description: Creates an account in the researchallofus.org domain.
      operationId: createAccount
      security: []
      parameters:
        - in: body
          name: createAccountRequest
          schema:
            $ref: "#/definitions/CreateAccountRequest"
      responses:
        200:
          description: Account created successfully.
          schema:
            $ref: "#/definitions/Profile"
        400:
          description: Error occurred while creating account.
          schema:
            $ref: "#/definitions/ErrorResponse"

  /v1/id-verification:
    post:
      tags:
        - profile
      consumes:
        - application/json
      description: Request identity verification.
      operationId: submitIdVerification
      responses:
        200:
          description: The user's profile.
          schema:
            $ref: "#/definitions/Profile"

  /v1/update-profile:
    post:
      tags:
        - profile
      consumes:
        - application/json
      description: Updates a users profile
      operationId: updateProfile
      parameters:
        - in: body
          name: updatedProfile
          description: the new profile to use
          schema:
            $ref: "#/definitions/Profile"
      responses:
        204:
          description: Request received.
        400:
          description: Bad request
          schema:
            $ref: "#/definitions/ErrorResponse"

  /v1/page-visits:
    post:
      tags:
      - profile
      consumes:
      - application/json
      description: Updates a users page visits
      operationId: updatePageVisits
      parameters:
        - in: body
          name: pageVisit
          description: the users pageVisits
          schema:
            $ref: "#/definitions/PageVisit"
      responses:
        200:
          description: The user's profile.
          schema:
            $ref: "#/definitions/Profile"
        400:
          description: Bad request
          schema:
            $ref: "#/definitions/ErrorResponse"

  # TODO: add signature / other state?
  /v1/account/accept-terms-of-service:
    post:
      tags:
        - profile
      consumes:
        - application/json
      description: Submits consent to the terms of service for researchers.
      operationId: submitTermsOfService
      responses:
        200:
          description: The user's profile.
          schema:
            $ref: "#/definitions/Profile"

  # TODO: add other state pertaining to ethics training?
  /v1/account/complete-ethics-training:
    post:
      tags:
        - profile
      consumes:
        - application/json
      description: Completes ethics training.
      operationId: completeEthicsTraining
      responses:
        200:
          description: The user's profile.
          schema:
            $ref: "#/definitions/Profile"

  # TODO: add demographic survey response data
  /v1/account/submit-demographic-survey:
    post:
      tags:
        - profile
      consumes:
        - application/json
      description: Submits demographic survey responses.
      operationId: submitDemographicsSurvey
      responses:
        200:
          description: The user's profile.
          schema:
            $ref: "#/definitions/Profile"

  /v1/auth-domain/{groupName}:
    post:
      tags:
        - authDomain
      consumes:
        - application/json
      description: This endpoint will create the registered auth domain.
      operationId: "createAuthDomain"
      parameters:
        - in: path
          name: groupName
          description: groupName
          required: true
          type: string
      responses:
        200:
          description: Successfully created group
          schema:
            $ref: "#/definitions/EmptyResponse"

  /v1/auth-domain/{groupName}/users:
    post:
      tags:
        - authDomain
      consumes:
        - application/json
      responses:
        204:
          description: Successfully Added User To Group
        403:
          description: You must be an admin of this group in order to remove members
          schema:
            $ref: '#/definitions/ErrorResponse'
        404:
          description: User not found
          schema:
            $ref: '#/definitions/ErrorResponse'
        500:
          description: FireCloud Internal Error
          schema:
            $ref: '#/definitions/ErrorResponse'
      parameters:
        - in: path
          name: groupName
          required: true
          type: string
        - in: body
          name: request
          description: request carrying user email to add
          schema:
            $ref: "#/definitions/AuthDomainRequest"
      summary: add a user to an auth domain if you have manage groups permission
      operationId: addUserToAuthDomain
    delete:
      responses:
        204:
          description: Successfully Removed User From Group
        403:
          description: You must be an admin of this group in order to remove members
          schema:
            $ref: '#/definitions/ErrorResponse'
        404:
          description: User not found
          schema:
            $ref: '#/definitions/ErrorResponse'
        500:
          description: FireCloud Internal Error
          schema:
            $ref: '#/definitions/ErrorResponse'
      parameters:
        - in: path
          name: groupName
          required: true
          type: string
        - in: body
          name: request
          description: request carrying user email to add
          schema:
            $ref: "#/definitions/AuthDomainRequest"
      tags:
        - authDomain
      summary: remove a user from an auth domain if you have manage groups permission
      operationId: removeUserFromAuthDomain

  /v1/user/{term}:
    get:
      tags:
        - user
      description: Returns user information matching search terms
      operationId: user
      responses:
        200:
          description: The user information matching supplied search terms
          schema:
            $ref: "#/definitions/UserResponse"
      parameters:
        - in: path
          name: term
          description: String to find in user's name or email address. Search is a case-insensitive substring match.
          required: true
          type: string
        - in: query
          name: pageToken
          description: >
            Pagination token retrieved from a previous call to user; used for retrieving additional pages of results.
          type: string
          required: false
        - in: query
          name: pageSize
          description: >
            Maximum number of results to return in a response. Defaults to 10.
          type: integer
          required: false
        - in: query
          name: sortOrder
          description: Sort order, either 'asc' or 'desc'. Defaults to 'asc' on the user's email.
          type: string
          required: false

  # Notebook clusters ####################################################################

  /v1/clusters:
    get:
      summary: List available notebook clusters
      description: >
        Returns the clusters available to the current user. Currently there is a
        single default cluster supported per researcher and this cluster should
        always either exist or be in the process of being initialized. In a
        future where researchers have more control over cluster creation, this
        endpoint would be extended to return all clusters.
      operationId: listClusters
      tags:
        - cluster
      responses:
        200:
          description: Available clusters
          schema:
            $ref: '#/definitions/ClusterListResponse'
        500:
          description: Internal Error
          schema:
            $ref: '#/definitions/ErrorResponse'

  /v1/clusters/{clusterNamespace}/{clusterName}:
    delete:
      summary: Delete a cluster by name.
      operationId: deleteCluster
      tags:
        - cluster
      parameters:
      - in: path
        name: clusterNamespace
        description: clusterNamespace
        required: true
        type: string
      - in: path
        name: clusterName
        description: clusterName
        required: true
        type: string
      responses:
        202:
          description: Deletion success
          schema:
            $ref: '#/definitions/EmptyResponse'
        500:
          description: Internal Error
          schema:
            $ref: '#/definitions/ErrorResponse'

  /v1/clusters/{clusterNamespace}/{clusterName}/localize:
    post:
      summary: >
        Localize files from a workspace to notebook cluster. As a side-effect,
        JSON workspace environment files will also be localized to the cluster.
      description: Localize notebook files to the corresponding notebook cluster.
      operationId: localize
      tags:
        - cluster
      consumes:
        - application/json
      parameters:
      - in: path
        name: clusterNamespace
        description: clusterNamespace
        required: true
        type: string
      - in: path
        name: clusterName
        description: clusterName
        required: true
        type: string
      - in: body
        name: body
        description: Localization request.
        schema:
          $ref: '#/definitions/ClusterLocalizeRequest'
      responses:
        200:
          description: Success
          schema:
            $ref: '#/definitions/ClusterLocalizeResponse'
        404:
          description: Cluster or Workspace not found
          schema:
            $ref: '#/definitions/ErrorResponse'
        500:
          description: Internal Error
          schema:
            $ref: '#/definitions/ErrorResponse'

  # Billing projects #####################################################################

  /v1/billingProjects:
    get:
      tags:
        - Profile
      operationId: getBillingProjects
      summary: List billing projects for a user
      responses:
        200:
          description: OK
          schema:
            type: array
            items:
              $ref: '#/definitions/BillingProjectMembership'
        404:
          description: User Not Found
        500:
          description: Internal Server Error

  # Workspaces ###########################################################################

  /v1/workspaces:
    get:
      tags:
        - workspaces
      description: Returns all workspaces that a user has access to
      operationId: getWorkspaces
      responses:
        200:
          description: A list of workspace definitions.
          schema:
            $ref: "#/definitions/WorkspaceResponseListResponse"
    post:
      tags:
        - workspaces
      consumes:
        - application/json
      description: Creates a workspace
      operationId: createWorkspace
      parameters:
        - in: body
          name: workspace
          description: workspace definition
          schema:
            $ref: "#/definitions/Workspace"
      responses:
        200:
          description: The workspace that was created.
          schema:
            $ref: "#/definitions/Workspace"

  /v1/workspaces/{workspaceNamespace}/{workspaceId}:
    parameters:
      - $ref: '#/parameters/workspaceNamespace'
      - $ref: '#/parameters/workspaceId'
    get:
      tags:
        - workspaces
      description: Returns the workspace definition with the specified ID and namespace
      operationId: getWorkspace
      responses:
        200:
          description: A workspace response containing workspace and access level
          schema:
            $ref: "#/definitions/WorkspaceResponse"
    patch:
      tags:
        - workspaces
      consumes:
        - application/json
      description: >
        Modifies the workspace definition with the specified ID and namespace;
        fields that are omitted will not be modified
      operationId: updateWorkspace
      parameters:
        - in: body
          name: workspace
          description: workspace definition
          schema:
            $ref: "#/definitions/UpdateWorkspaceRequest"
      responses:
        200:
          description: The updated workspace definition
          schema:
            $ref: "#/definitions/Workspace"
    delete:
      tags:
        - workspaces
      description: Deletes the workspace definition with the specified ID and namespace
      operationId: deleteWorkspace
      responses:
        202:
          description: Workspace deletion request accepted
          schema:
            $ref: '#/definitions/EmptyResponse'

  /v1/admin/workspaces/review:
    get:
      tags:
        - workspaces
      description: >
          Returns workspaces that need research purpose review. Requires
          REVIEW_RESEARCH_PURPOSE authority.
      operationId: getWorkspacesForReview
      responses:
        200:
          description: A list of workspaces
          schema:
            $ref: "#/definitions/WorkspaceListResponse"

  /v1/workspaces/{workspaceNamespace}/{workspaceId}/notebook-list:
    get:
      summary: Get details of Python files from google Bucket directory notebook
      description: >
        Returns list of name and path of python files from google bucket,
        directory notebook.
      operationId: getNoteBookList
      tags:
        - workspaces
      parameters:
        - in: path
          name: workspaceNamespace
          description: workspaceNamespace
          required: true
          type: string
        - in: path
          name: workspaceId
          description: workspaceId
          required: true
          type: string
      responses:
        200:
          description: List of files
          schema:
            type: array
            items:
              $ref: '#/definitions/FileDetail'
        404:
          description: Workspace not found
          schema:
            $ref: '#/definitions/ErrorResponse'
        500:
          description: Internal Error
          schema:
            $ref: '#/definitions/ErrorResponse'

  /v1/admin/users/id-verification/list:
    get:
      tags:
        - profile
      description: >
          Returns a list of profiles for users to be reviewed. Requires
          REVIEW_ID_VERIFICATION authority.
      operationId: getIdVerificationsForReview
      responses:
        200:
          description: A list of users to be id verified
          schema:
            $ref: "#/definitions/IdVerificationListResponse"
        403:
          description: User doesn't have the REVIEW_ID_VERIFICATION authority
          schema:
            $ref: "#/definitions/ErrorResponse"

  /v1/admin/users/id-verification/{userId}/review:
    parameters:
      - $ref: '#/parameters/userId'
    post:
      tags:
        - profile
      consumes:
        - application/json
      description: >
          Manually sets the ID verfication status for a user. Requires
          REVIEW_ID_VERIFICATION authority.
      operationId: reviewIdVerification
      parameters:
        - in: body
          name: review
          schema:
            $ref: "#/definitions/IdVerificationReviewRequest"
      responses:
        200:
          description: return updated list of profiles
          schema:
            $ref: "#/definitions/IdVerificationListResponse"

  /v1/admin/workspaces/{workspaceNamespace}/{workspaceId}/review:
    parameters:
      - $ref: '#/parameters/workspaceNamespace'
      - $ref: '#/parameters/workspaceId'
    post:
      tags:
        - workspaces
      consumes:
        - application/json
      description: Sets a research purpose review result.
      operationId: reviewWorkspace
      parameters:
        - in: body
          name: review
          description: result of the research purpose review
          schema:
            $ref: "#/definitions/ResearchPurposeReviewRequest"
      responses:
        200:
          description: success
          schema:
            $ref: "#/definitions/EmptyResponse"

  # Note: all requests tagged as "cron" must have the header X-Appengine-Cron:
  # true, which app engine itself only sets when invoking as a cronjob.
  # See https://cloud.google.com/appengine/docs/standard/java/config/cron#securing_urls_for_cron

  /v1/cron/auditBigQuery:
    get:
      security: []
      tags:
        - audit
        - cron
      description: >
        Endpoint meant to be called offline to trigger BigQuery auditing; may be
        slow to execute. Only executable via App Engine cronjob.
      operationId: auditBigQuery
      responses:
        200:
          description: Audit was successful.
          schema:
            $ref: "#/definitions/AuditBigQueryResponse"

  /v1/cron/checkClusters:
    get:
      security: []
      tags:
        - offlineCluster
        - cron
      description: >
        Endpoint meant to be called offline to trigger cluster checks and
        cleanup. Enforces upgrades for older cluster deployments. May be slow to
        execute. Only executable via App Engine cronjob.
      operationId: checkClusters
      responses:
        200:
          description: Clusters were checked and handled successfully.
          schema:
            $ref: "#/definitions/CheckClustersResponse"

  /v1/workspaces/{workspaceNamespace}/{workspaceId}/share:
    parameters:
      - $ref: '#/parameters/workspaceNamespace'
      - $ref: '#/parameters/workspaceId'
    post:
      tags:
        - workspaces
      consumes:
        - application/json
      description: Shares a workspace with users
      operationId: shareWorkspace
      parameters:
          - in: body
            name: body
            description: users to share the workspace with
            schema:
              $ref: "#/definitions/ShareWorkspaceRequest"
      responses:
        200:
          description: Successful share response
          schema:
            $ref: "#/definitions/ShareWorkspaceResponse"

  /v1/workspaces/{workspaceNamespace}/{workspaceId}/clone:
    parameters:
      - $ref: '#/parameters/workspaceNamespace'
      - $ref: '#/parameters/workspaceId'
    post:
      tags:
        - workspaces
      consumes:
        - application/json
      description: >
        Clone an existing workspace, with given modifications to workspace metadata. Caller will own
        the newly cloned workspace, and must have read access to the source workspace. In
        addition to workspace metadata, the following will also be cloned:
          - the associated Firecloud workspace
          - cohorts, along with reviews and annotations
          - notebooks located in the default notebook directory for this workspace
      operationId: cloneWorkspace
      parameters:
          - in: body
            name: body
            schema:
              $ref: "#/definitions/CloneWorkspaceRequest"
      responses:
        200:
          description: Successful clone response
          schema:
            $ref: "#/definitions/CloneWorkspaceResponse"

  # Notebooks ############################################################################

  /v1/workspaces/{workspaceNamespace}/{workspaceId}/notebooks/rename:
    parameters:
      - $ref: '#/parameters/workspaceNamespace'
      - $ref: '#/parameters/workspaceId'
    post:
      tags:
        - workspaces
      consumes:
        - application/json
      description: Renames specified notebook
      operationId: "renameNotebook"
      parameters:
        - in: body
          name: NotebookRename
          description: new name for notebook
          required: true
          schema:
            type: object
            properties:
              name:
                type: string
              newName:
                type: string
      responses:
        200:
          description: Successful rename
          schema:
            $ref: "#/definitions/FileDetail"


  /v1/workspaces/{workspaceNamespace}/{workspaceId}/notebooks/{notebookName}/clone:
    parameters:
      - $ref: '#/parameters/workspaceNamespace'
      - $ref: '#/parameters/workspaceId'
    post:
      tags:
        - workspaces
      consumes:
        - application/json
      description: Clones specified notebook
      operationId: "cloneNotebook"
      parameters:
        - in: path
          name: notebookName
          required: true
          type: string
      responses:
        200:
          description: Successful clone
          schema:
            $ref: "#/definitions/FileDetail"

  /v1/workspaces/{workspaceNamespace}/{workspaceId}/notebooks/{notebookName}/delete:
    parameters:
      - $ref: '#/parameters/workspaceNamespace'
      - $ref: '#/parameters/workspaceId'
    delete:
      tags:
        - workspaces
      description: Deletes specified notebook
      operationId: "deleteNotebook"
      parameters:
        - in: path
          name: notebookName
          required: true
          type: string
      responses:
        200:
          description: Successful delete
          schema:
            $ref: "#/definitions/EmptyResponse"

  # Cohorts ##############################################################################

  /v1/workspaces/{workspaceNamespace}/{workspaceId}/cohorts:
    parameters:
      - $ref: '#/parameters/workspaceNamespace'
      - $ref: '#/parameters/workspaceId'
    get:
      tags:
        - cohorts
      description: Returns all cohort definitions in a workspace
      operationId: "getCohortsInWorkspace"
      responses:
        200:
          description: A list of cohort definitions.
          schema:
            $ref: "#/definitions/CohortListResponse"
    post:
      tags:
        - cohorts
      consumes:
        - application/json
      description: Creates a cohort definition in a workspace.
      operationId: "createCohort"
      parameters:
        - in: body
          name: cohort
          description: cohort definition
          schema:
            $ref: "#/definitions/Cohort"
      responses:
        200:
          description: The cohort definition that was created.
          schema:
            $ref: "#/definitions/Cohort"

  /v1/workspaces/{workspaceNamespace}/{workspaceId}/cohorts/{cohortId}:
    parameters:
      - $ref: '#/parameters/workspaceNamespace'
      - $ref: '#/parameters/workspaceId'
      - $ref: '#/parameters/cohortId'
    get:
      tags:
        - cohorts
      description: Returns the cohort definition with the specified ID
      operationId: "getCohort"
      responses:
        200:
          description: A cohort definition
          schema:
            $ref: "#/definitions/Cohort"
    patch:
      tags:
        - cohorts
      consumes:
        - application/json
      description: >
        Modifies the cohort definition with the specified ID; fields that are omitted
        will not be modified
      operationId: "updateCohort"
      parameters:
        - in: body
          name: cohort
          description: cohort definition
          schema:
            $ref: "#/definitions/Cohort"
      responses:
        200:
          description: The updated cohort definition
          schema:
            $ref: "#/definitions/Cohort"
    delete:
      tags:
        - cohorts
      description: Deletes the cohort definition with the specified ID
      operationId: "deleteCohort"
      responses:
        202:
          description: ACCEPTED
          schema:
            $ref: '#/definitions/EmptyResponse'

  /v1/workspaces/{workspaceNamespace}/{workspaceId}/materializeCohort:
    parameters:
      - $ref: '#/parameters/workspaceNamespace'
      - $ref: '#/parameters/workspaceId'
    post:
      tags:
        - cohorts
      consumes:
        - application/json
      description: >
        Materializes a cohort for a given CDR version to specified output.
      operationId: "materializeCohort"
      parameters:
       - in: body
         name: request
         description: cohort materialization request
         schema:
           $ref: "#/definitions/MaterializeCohortRequest"
      responses:
        200:
          description: The results of materializing the cohort
          schema:
            $ref: "#/definitions/MaterializeCohortResponse"

######### USER RECENT RESOURCES ########################################
  /v1/workspaces/user-recent-resources:
    get:
      tags:
        - userMetrics
      description: Returns the resources accessed by user order by access time desc
      operationId: getUserRecentResources
      responses:
        200:
          description: A list of resources order by last access time desc order
          schema:
            $ref: "#/definitions/RecentResourceResponse"

  /v1/workspaces/{workspaceNamespace}/{workspaceId}/user-recent-resources/update:
    parameters:
      - $ref: '#/parameters/workspaceNamespace'
      - $ref: '#/parameters/workspaceId'
    post:
      tags:
        - userMetrics
      consumes:
        - application/json
      description: Add/update user recent resource
      operationId: updateRecentResource
      parameters:
        - in: body
          name: RecentResourceRequest
          description: request object for updating recent resource
          required: true
          schema:
            # this is currently only ever used by Notebooks because other
            # resources are stored in our db, and therefore cache ops are
            # done for them in the backend
            $ref: "#/definitions/RecentResourceRequest"
      responses:
        200:
          description: Successfully added/updated
          schema:
            $ref: "#/definitions/RecentResource"

  /v1/workspaces/{workspaceNamespace}/{workspaceId}/user-recent-resources/delete:
    parameters:
      - $ref: '#/parameters/workspaceNamespace'
      - $ref: '#/parameters/workspaceId'
    delete:
      tags:
        - userMetrics
      description: Deletes entry from recent resource
      operationId: deleteRecentResource
      parameters:
        - in: body
          name: RecentResourceRequest
          description: request object for updating recent resource
          required: true
          schema:
            $ref: "#/definitions/RecentResourceRequest"
      responses:
        200:
          description: Successfully deleted
          schema:
            $ref: "#/definitions/EmptyResponse"


# Concept sets ##############################################################################

  /v1/workspaces/{workspaceNamespace}/{workspaceId}/concept-sets:
    parameters:
      - $ref: '#/parameters/workspaceNamespace'
      - $ref: '#/parameters/workspaceId'
    get:
      tags:
        - conceptSets
      description: Returns all concept sets in a workspace
      operationId: "getConceptSetsInWorkspace"
      responses:
        200:
          description: A list of concept sets.
          schema:
            $ref: "#/definitions/ConceptSetListResponse"
    post:
      tags:
        - conceptSets
      consumes:
        - application/json
      description: Creates a concept set in a workspace.
      operationId: "createConceptSet"
      parameters:
        - in: body
          name: request
          description: create concept set request
          schema:
            $ref: "#/definitions/CreateConceptSetRequest"
      responses:
        200:
          description: The concept set that was created.
          schema:
            $ref: "#/definitions/ConceptSet"

  /v1/workspaces/{workspaceNamespace}/{workspaceId}/concept-sets/{conceptSetId}:
    parameters:
      - $ref: '#/parameters/workspaceNamespace'
      - $ref: '#/parameters/workspaceId'
      - $ref: '#/parameters/conceptSetId'
    get:
      tags:
        - conceptSets
      description: Returns the concept set definition with the specified ID
      operationId: "getConceptSet"
      responses:
        200:
          description: A concept set definition
          schema:
            $ref: "#/definitions/ConceptSet"
    patch:
      tags:
        - conceptSets
      consumes:
        - application/json
      description: >
        Modifies the name or description of the concept set with the specified ID;
        fields that are omitted will not be modified
      operationId: "updateConceptSet"
      parameters:
        - in: body
          name: conceptSet
          description: concept set definition
          schema:
            $ref: "#/definitions/ConceptSet"
      responses:
        200:
          description: The updated concept set.
          schema:
            $ref: "#/definitions/ConceptSet"
    delete:
      tags:
        - conceptSets
      description: Deletes the concept set with the specified ID
      operationId: "deleteConceptSet"
      responses:
        202:
          description: ACCEPTED
          schema:
            $ref: '#/definitions/EmptyResponse'

  /v1/workspaces/{workspaceNamespace}/{workspaceId}/concept-sets/{conceptSetId}/concepts:
    parameters:
      - $ref: '#/parameters/workspaceNamespace'
      - $ref: '#/parameters/workspaceId'
      - $ref: '#/parameters/conceptSetId'
    post:
      tags:
        - conceptSets
      consumes:
        - application/json
      description: >
        Adds or removes concepts from the concept set.
      operationId: "updateConceptSetConcepts"
      parameters:
        - in: body
          name: request
          description: update concept set request
          schema:
            $ref: "#/definitions/UpdateConceptSetRequest"
      responses:
        200:
          description: The updated concept set.
          schema:
            $ref: "#/definitions/ConceptSet"

# Concepts ###############################################################################

  /v1/workspaces/{workspaceNamespace}/{workspaceId}/domainInfo:
      get:
        tags:
          - concepts
        description: >
          Returns information on the domains of data in the workspace's CDR version along
          with participant and concept counts
        operationId: "getDomainInfo"
        parameters:
          - $ref: '#/parameters/workspaceNamespace'
          - $ref: '#/parameters/workspaceId'
        responses:
          200:
            description: information on the domains
            schema:
              $ref: "#/definitions/DomainInfoResponse"

##########################################################################################
## DEFINITIONS
##########################################################################################
definitions:

  StatusResponse:
    type: object
    required:
      - firecloudStatus
      - notebooksStatus
    properties:
      firecloudStatus:
        type: boolean
      notebooksStatus:
        type: boolean

  ConfigResponse:
    type: object
    required:
      - gsuiteDomain
    properties:
      # This should be gSuiteDomain, but the Swagger-Codegen-generated server code causes the JSON
      # response to have the keys "gsuiteDomain" and "gSuiteDomain". This weirdness is a workaround.
      gsuiteDomain:
        type: string
        description: G-Suite domain containing user accounts.
      projectId:
        type: string
        description: The cloud project in which this app is running.
      enforceRegistered:
        type: boolean
        description: |
          Whether the user's data access level should gate other Workbench functionality, namely
          to functionality requiring CDR access.
      publicApiKeyForErrorReports:
        type: string
        description: |
          Stackdriver API key for error reporting, scoped to a particular
          domain. If unset, Stackdriver error reporting should be disabled.

  # Mirrors BillingProjectMembership from fireCloud.yaml
  BillingProjectMembership:
    description: ''
    required:
      - projectName
      - role
      - status
    type: object
    properties:
      projectName:
        type: string
        description: the name of the project
      role:
        type: string
        description: the role of the current user in the project
      status:
        $ref: "#/definitions/BillingProjectStatus"

  BillingProjectStatus:
    type: string
    description: >
      Initialization status of a Firecloud billing project for use with Workbench.
    enum: &BILLING_PROJECT_STATUS [none, pending, ready, error]

  EmailVerificationStatus:
    type: string
    description: stage of email verification
    enum: &EMAIL_VERIFICATION_STATUS [unverified, pending, subscribed]

  EmptyResponse:
    type: object
    properties:
      additionalInfo:
        type: string

  VerifyEmailRequest:
    type: object
    properties:
      emailToVerify:
        type: string
      username:
        type: string

  Authority:
    type: string
    description: actions a user can have authority/permission to perform
    enum: [
        # Note: Swagger trims any common prefix from enum values' corresponding
        # Java fields by default; this has no side-effect currently as there is
        # no common prefix. https://github.com/swagger-api/swagger-codegen/issues/4261
        REVIEW_RESEARCH_PURPOSE,
        MANAGE_GROUP,
        REVIEW_ID_VERIFICATION
    ]

  PageVisit:
    type: object
    properties:
      userId:
        type: integer
        format: int64
      page:
        type: string
      firstVisit:
        type: integer
        format: int64

  WorkspaceListResponse:
    type: object
    required:
     - items
    properties:
      items:
        type: "array"
        items:
           $ref: "#/definitions/Workspace"

  WorkspaceResponseListResponse:
    type: object
    required:
     - items
    properties:
      items:
        type: "array"
        items:
           $ref: "#/definitions/WorkspaceResponse"

  Workspace:
    type: object
    required:
     - name
    properties:
      id:
        type: string
      etag:
        type: string
        description: >
          Entity tag for optimistic concurrency control. To be set during a
          read-modify-write to ensure that the client has not attempted to
          modify a changed resource.
      name:
        type: string
      namespace:
        type: string
      description:
        type: string
      cdrVersionId:
        type: string
      creator:
        type: string
      googleBucketName:
        type: string
      dataAccessLevel:
        $ref: "#/definitions/DataAccessLevel"
      researchPurpose:
        $ref: "#/definitions/ResearchPurpose"
      creationTime:
        type: integer
        format: int64
        description: Milliseconds since the UNIX epoch.
      lastModifiedTime:
        type: integer
        format: int64
        description: Milliseconds since the UNIX epoch.
      userRoles:
        type: "array"
        items:
           $ref: "#/definitions/UserRole"

  UserRole:
    type: object
    required:
      - email
      - role
    properties:
      email:
        type: string
      givenName:
        type: string
      familyName:
        type: string
      role:
        $ref: "#/definitions/WorkspaceAccessLevel"

  ShareWorkspaceRequest:
    type: object
    required:
     - items
    properties:
      workspaceEtag:
        type: string
        description: >
          Associated workspace etag retrieved via reading the workspaces API. If provided,
          validates that the workspace (and its user roles) has not been modified since this
          etag was retrieved.
      items:
        type: "array"
        items:
           $ref: "#/definitions/UserRole"

  ShareWorkspaceResponse:
    type: object
    properties:
      workspaceEtag:
        type: string
        description: >
          Updated workspace etag after the share request has been applied.
      items:
        type: "array"
        items:
          $ref: "#/definitions/UserRole"

  CloneWorkspaceRequest:
    type: object
    required:
     - workspace
    properties:
      includeUserRoles:
        type: boolean
        description: >
          Whether to clone the user roles (sharing settings) on the workspace.
          By default, clone follows the behavior of CreateWorkspace - it is
          shared solely with the creator as an OWNER. If true, all user roles
          are also copied onto the new workspace in addition to the caller
          becoming an OWNER.
      workspace:
        $ref: "#/definitions/Workspace"
        description: >
          Workspace metadata to be applied to the cloned workspace upon creation. The following
          workspace fields are accepted:
            - name (required)
            - namespace (required)
            - researchPurpose (required)
            - description: defaults to the cloned workspace description
            - cdrVersionId defaults to the cloned workspace CDR version

          All other fields will be ignored and are generated server-side or are copied from the
          cloned workspace.

  CloneWorkspaceResponse:
    type: object
    properties:
      workspace:
        $ref: "#/definitions/Workspace"
        description: The newly created workspace clone.

  UpdateWorkspaceRequest:
    type: object
    required:
     - workspace
    properties:
      workspace:
        $ref: "#/definitions/Workspace"

  WorkspaceAccessLevel:
    type: string
    description: levels of access to workspace, NO ACCESS is akin to removing a user from a workspace ACL
    enum: [NO ACCESS, READER, WRITER, OWNER]

  ResearchPurpose:
    type: object
    required:
     - diseaseFocusedResearch
     - methodsDevelopment
     - controlSet
     - aggregateAnalysis
     - ancestry
     - commercialPurpose
     - population
     - reviewRequested
     - underservedPopulation
    properties:
      diseaseFocusedResearch:
        type: boolean
        default: false
      diseaseOfFocus:
        type: string
      methodsDevelopment:
        type: boolean
        default: false
      controlSet:
        type: boolean
        default: false
      aggregateAnalysis:
        type: boolean
        default: false
      ancestry:
        type: boolean
        default: false
      commercialPurpose:
        type: boolean
        default: false
      population:
        type: boolean
        default: false
      populationOfFocus:
        type: string
      reviewRequested:
        type: boolean
        default: false
      containsUnderservedPopulation:
        type: boolean
        default: false
      underservedPopulationDetails:
        type: array
        items:
          $ref: "#/definitions/underservedPopulationEnum"
      timeRequested:
        type: integer
        format: int64
        description: Milliseconds since the UNIX epoch.
      approved:
        type: boolean
      timeReviewed:
        type: integer
        format: int64
        description: Milliseconds since the UNIX epoch.
      additionalNotes:
        type: string

  underservedPopulationEnum:
    type: string
    description: Short parsable descriptions of underserved populations
    enum: [
      RACE_AMERICAN_INDIAN_OR_ALASKA_NATIVE,
      RACE_ASIAN,
      RACE_BLACK_AFRICAN_OR_AFRICAN_AMERICAN,
      RACE_HISPANIC_OR_LATINO,
      RACE_MIDDLE_EASTERN_OR_NORTH_AFRICAN,
      RACE_NATIVE_HAWAIIAN_OR_PACIFIC_ISLANDER,
      RACE_MORE_THAN_ONE_RACE,
      AGE_CHILDREN,
      AGE_ADOLESCENTS,
      AGE_OLDER_ADULTS,
      AGE_ELDERLY,
      SEX_FEMALE,
      SEX_INTERSEX,
      SEXUAL_ORIENTATION_GAY,
      SEXUAL_ORIENTATION_LESBIAN,
      SEXUAL_ORIENTATION_BISEXUAL,
      SEXUAL_ORIENTATION_POLYSEXUAL_OMNISEXUAL_SAPIOSEXUAL_OR_PANSEXUAL,
      SEXUAL_ORIENTATION_ASEXUAL,
      SEXUAL_ORIENTATION_TWO_SPIRIT,
      SEXUAL_ORIENTATION_FIGURING_OUT_SEXUALITY,
      SEXUAL_ORIENTATION_MOSTLY_STRAIGHT,
      SEXUAL_ORIENTATION_DOES_NOT_THINK_OF_HAVING_SEXUALITY,
      SEXUAL_ORIENTATION_DOES_NOT_USE_LABELS,
      SEXUAL_ORIENTATION_DOES_NOT_KNOW_ANSWER,
      GENDER_IDENTITY_WOMAN,
      GENDER_IDENTITY_NON_BINARY,
      GENDER_IDENTITY_TRANSMAN,
      GENDER_IDENTITY_TRANSWOMAN,
      GENDER_IDENTITY_GENDERQUEER,
      GENDER_IDENTITY_GENDERFLUID,
      GENDER_IDENTITY_GENDER_VARIANT,
      GENDER_IDENTITY_QUESTIONING,
      GEOGRAPHY_URBAN_CLUSTERS,
      GEOGRAPHY_RURAL,
      DISABILITY_PHYSICAL,
      DISABILITY_MENTAL,
      ACCESS_TO_CARE_NOT_PAST_TWELVE_MONTHS,
      ACCESS_TO_CARE_CANNOT_OBTAIN_OR_PAY_FOR,
      EDUCATION_INCOME_LESS_THAN_HIGH_SCHOOL_GRADUATE,
      EDUCATION_INCOME_LESS_THAN_TWENTY_FIVE_THOUSAND_FOR_FOUR_PEOPLE
    ]

  ResearchPurposeReviewRequest:
    description: Approve or reject a workspace's research purpose.
    type: object
    required:
      - approved
    properties:
      approved:
        type: boolean

  IdVerificationReviewRequest:
    type: object
    required:
      - newStatus
    properties:
      newStatus:
        $ref: "#/definitions/IdVerificationStatus"

  CohortListResponse:
    type: object
    required:
      - items
    properties:
      items:
        type: "array"
        items:
           $ref: "#/definitions/Cohort"

  Cohort:
    type: object
    required:
      - name
      - criteria
      - type
    properties:
      id:
        type: integer
        format: int64
      etag:
        type: string
        description: >
          Entity tag for optimistic concurrency control. To be set during a
          read-modify-write to ensure that the client has not attempted to
          modify a changed resource.
      name:
        type: string
      criteria:
        description: >
          Internal representation of the cohort definition. Clients should not depend directly
          on this, but instead call client functions to issue a SQL query for the cohort.
        type: string
      type:
        type: string
      description:
        type: string
      creator:
        type: string
      creationTime:
        type: integer
        format: int64
        description: Milliseconds since the UNIX epoch.
      lastModifiedTime:
        type: integer
        format: int64
        description: Milliseconds since the UNIX epoch.

  MaterializeCohortRequest:
    type: object
    properties:
      cohortName:
        description: >
         The name of a cohort that is to be evaluated. Either this or cohortSpec should be specified
        type: string
      cohortSpec:
        description: >
          JSON representation of a cohort to be evaluated (using the same format used for saved
          cohorts). Either this or cohortName should be specified
        type: string
      statusFilter:
        description: >
          An array of status values; participants with these statuses will be included.
          Defaults to [NOT_REVIEWED, INCLUDED, NEEDS_FURTHER_REVIEW] -- everything but EXCLUDED.
          Only valid for use with cohortName (cohorts saved in the database.)
        type: array
        items:
          $ref: "#/definitions/CohortStatus"
      cdrVersionName:
        description: >
          The name of a CDR version to use when evaluating the cohort; if none is specified,
          the CDR version currently associated with the workspace will be used
        type: string
      pageToken:
        description: >
          Pagination token retrieved from a previous call to materializeCohort; used for
          retrieving additional pages of results. If this is specified, all other fields on
          MaterializeCohortRequest apart from pageSize must match the values specified
          on the request that generated this token.
        type: string
      pageSize:
        description: >
          Maximum number of results to return in a response. Defaults to 1000.
        type: integer
        format: int32
      fieldSet:
        description: >
          Specification defining what data to return for participants in the cohort. Defaults to
          just participant IDs.
        $ref: "#/definitions/FieldSet"

  FieldSet:
    type: object
    description: >
      A specification for fields to retrieve about participants in a cohort.
      Exactly one of the properties below should be specified.
    properties:
      tableQuery:
        description: >
          A query specifying how to pull data out of a single table. Either this or annotationQuery
          should be set (not both.)
        $ref: "#/definitions/TableQuery"
      annotationQuery:
        description: >
          A query specifying how to retrieve annotation values created about participants in a
          cohort during cohort review. Either this or tableQuery should be set (not both.)
        $ref: "#/definitions/AnnotationQuery"

  MaterializeCohortResponse:
    type: object
    required:
      - results
    properties:
      results:
        description: >
          An array of JSON dictionaries representing results to the cohort materialization.
          (In Java, this is represented as Map<String, Object>[]. In Python clients, this is a
          list[object] where each object is a dictionary. In Typescript clients, this is an
          Array<any> where each object is a dictionary.) Keys in the dictionaries will be the
          columns selected in the field set provided in the request, and the values will
          be the values of those columns.
        type: array
        items:
          type: object
      nextPageToken:
        description: >
          Pagination token that can be used in a subsequent call to MaterializeCohortRequest to
          retrieve more results. If not set, there are no more results to retrieve.
        type: string

  ConceptSetListResponse:
    type: object
    required:
      - items
    properties:
      items:
        type: "array"
        items:
           $ref: "#/definitions/ConceptSet"

  ConceptSet:
    type: object
    required:
      - name
      - type
    properties:
      id:
        type: integer
        format: int64
      etag:
        type: string
        description: >
          Entity tag for optimistic concurrency control. To be set during a
          read-modify-write to ensure that the client has not attempted to
          modify a changed resource.
      name:
        type: string
      domain:
        description: >
          Domain corresponding to an OMOP table that can contain rows for the concepts in this
          concept set. Note that the Domain values RACE, GENDER, and ETHNICITY are not allowed
          here; it makes sense to specify concepts in these domains in cohort criteria, but
          there isn't much value in having concept sets defined for them.
        $ref: "#/definitions/Domain"
      description:
        type: string
      creator:
        type: string
      creationTime:
        type: integer
        format: int64
        description: Milliseconds since the UNIX epoch.
      lastModifiedTime:
        type: integer
        format: int64
        description: Milliseconds since the UNIX epoch.
      participantCount:
        type: integer
        format: int32
        description: >
          Count of participants in the CDR version for the workspace containing this
          concept set that match the specified concept set
      concepts:
        description: "Concepts in the concept set, in conceptName order."
        type: array
        items:
          $ref: "#/definitions/Concept"

  CreateConceptSetRequest:
    type: object
    required:
      - conceptSet
    properties:
      conceptSet:
        description: Concept set to be created; concepts is ignored
        $ref: "#/definitions/ConceptSet"
      addedIds:
        type: array
        description: The IDs of concepts to be added to the concept set.
        items:
          type: integer
          format: int64

  UpdateConceptSetRequest:
    type: object
    required:
      - etag
    properties:
      etag:
        type: string
        description: >
          Etag of the concept set being modified.
          Validates that the concept set has not been modified since this
          etag was retrieved.
      addedIds:
        type: array
        description: >
          The IDs of concepts to be added to the concept set.
        items:
          type: integer
          format: int64
      removedIds:
        type: array
        description: >
          The IDs of concepts to be removed from the concept set.
        items:
          type: integer
          format: int64

  DomainInfoResponse:
    type: object
    required:
      - items
    properties:
      items:
        type: "array"
        items:
          $ref: "#/definitions/DomainInfo"


  CreateAccountRequest:
    type: object
    properties:
      profile:
        $ref: '#/definitions/Profile'
      invitationKey:
        type: string

  InvitationVerificationRequest:
    type: object
    required:
      - invitationKey
    properties:
      invitationKey:
        type: string
        description: Invitation key for verification

  ResendWelcomeEmailRequest:
    type: object
    required:
      - username
      - creationNonce
    properties:
      username:
        type: string
        description: Username of account to resend welcome email to
      creationNonce:
        type: string
        description: The nonce returned from the account creation API.

  UpdateContactEmailRequest:
    type: object
    required:
      - contactEmail
      - username
      - creationNonce
    properties:
      contactEmail:
        type: string
        description: Email to update contact email
      username:
        type: string
        description: Username for account.
      creationNonce:
        type: string
        description: The nonce returned from the account creation API.

  BugReport:
    type: object
    required:
      - shortDescription
      - contactEmail
    properties:
      bugType:
        $ref: "#/definitions/BugReportType"
      shortDescription:
        description: A short description of the bug
        type: string
      reproSteps:
        description: Steps to reproduce the bug
        type: string
      includeNotebookLogs:
        description:
          Whether or not to include notebook server logs in the bug
          report.
        type: boolean
      contactEmail:
        description: The email with which to contact the bug reporter.
        type: string

  BugReportType:
    type: string
    description: Possible value for bug reports
    enum: [APPLICATION, DATA]

  Profile:
    type: object
    required:
      - username
      - dataAccessLevel
    properties:
      userId:
        description: researchallofus userId
        type: integer
        format: int64
      username:
        description: researchallofus username
        type: string
      creationNonce:
        description: >
          A value which can be used to secure API calls during the account
          creation flow, prior to account login.
        type: string
      contactEmail:
        description: email address that can be used to contact the user
        type: string
      contactEmailFailure:
        description: Whether or not contact email could be added to verification list
        type: boolean
      firstSignInTime:
        type: integer
        format: int64
      freeTierBillingProjectName:
        description: name of the AllOfUs free tier billing project created for this user
        type: string
      freeTierBillingProjectStatus:
        description: >
          the initialization status of the free tier billing project, some
          workbench functionality may not work fully with this project until it
          is fully initialized
        $ref: "#/definitions/BillingProjectStatus"
      dataAccessLevel:
        description: what level of data access the user has
        $ref: "#/definitions/DataAccessLevel"
      givenName:
        description: the user's given name (e.g. Alice)
        type: string
      familyName:
        description: the user's family  name (e.g. Jones)
        type: string
      phoneNumber:
        description: the user's phone number
        type: string
      currentPosition:
        description: the user's curent position (job title)
        type: string
      organization:
        description: the user's current organization
        type: string
      authorities:
        description: authorities granted to this user
        type: "array"
        items:
          $ref: "#/definitions/Authority"
      pageVisits:
        description: pages user has visited
        type: "array"
        items:
          $ref: "#/definitions/PageVisit"
      idVerificationStatus:
        $ref: "#/definitions/IdVerificationStatus"
        description: Status of ID verification
      termsOfServiceCompletionTime:
        type: integer
        format: int64
        description: Timestamp when the user consented to terms of service in milliseconds since the UNIX epoch.
      ethicsTrainingCompletionTime:
        type: integer
        format: int64
        description: Timestamp when the user completed ethics training in milliseconds since the UNIX epoch.
      demographicSurveyCompletionTime:
        type: integer
        format: int64
        description: Timestamp when the user completed a demographic survey in milliseconds since the UNIX epoch.
      disabled:
        type: boolean
      emailVerificationStatus:
        $ref: "#/definitions/EmailVerificationStatus"
      aboutYou:
        type: string
      areaOfResearch:
        type: string
      institutionalAffiliations:
        type: "array"
        items:
          $ref: "#/definitions/InstitutionalAffiliation"
      requestedIdVerification:
        type: boolean
      idVerificationRequestTime:
        type: integer
        format: int64
        description: Timestamp when the user requests identity verification.
      twoFactorEnabled:
        type: boolean

  InstitutionalAffiliation:
    type: object
    required:
      - institution
      - role
    properties:
      institution:
        type: string
      role:
        type: string

  IdVerificationStatus:
    type: string
    description: possible values indicating whether the user's ID has been verified
    enum: [UNVERIFIED, VERIFIED, REJECTED]

  StackTraceElement:
    description: ''
    required:
      - className
      - methodName
      - fileName
      - lineNumber
    properties:
      className:
        type: string
        description: class name
      methodName:
        type: string
        description: method name
      fileName:
        type: string
        description: source file name
      lineNumber:
        type: integer
        description: line number

  ClusterStatus:
    type: string
    enum: &CLUSTERSTATUS
      - Creating
      - Running
      - Updating
      - Error
      - Stopping
      - Stopped
      - Starting
      - Deleting
      - Deleted
      - Unknown

  Cluster:
    description: A Firecloud notebook cluster.
    required:
      - clusterName
      - clusterNamespace
      - status
    properties:
      clusterName:
        type: string
        description: The user-supplied name for the cluster
      clusterNamespace:
        type: string
        description: The Google Project used to create the cluster
      status:
        $ref: "#/definitions/ClusterStatus"
      createdDate:
        type: string
        description: The date and time the cluster was created, in ISO-8601 format

  FileDetail:
    type: object
    required:
      - name
      - path
      - lastModifiedTime
    properties:
      name:
        type: string
        description: File Name
      path:
        type: string
        description: The path is in format of gs://bucket-name/name
      lastModifiedTime:
        type: integer
        format: int64
        description: Milliseconds since the UNIX epoch.

  ClusterListResponse:
    type: object
    required:
      - defaultCluster
    properties:
      defaultCluster:
        $ref: "#/definitions/Cluster"

  ClusterLocalizeRequest:
    type: object
    required:
      - workspaceNamespace
      - workspaceId
      - notebookNames
      - playgroundMode
    properties:
      workspaceNamespace:
        type: string
        description: Workspace namespace from which to source notebooks
      workspaceId:
        type: string
        description: Workspace from which to source notebooks
      notebookNames:
        type: array
        description: >
          Names of notebooks to localize. This is just the basename (no gs://
          needed). This is interpreted as relative to the /notebooks directory
          within the provided workspace's Google Cloud Storage bucket.
        items:
          type: string
      playgroundMode:
        type: boolean
        description: Set to true if playgroundMode needed

  ClusterLocalizeResponse:
    type: object
    required:
      - clusterLocalDirectory
    properties:
      clusterLocalDirectory:
        type: string
        description: >
          The directory on the notebook cluster file system where the requested
          files were localized. This is the "API" directory in Jupyter terms,
          which means it is a relative path in the Jupyter user-facing file
          system, e.g. "foo/bar.ipynb".

  UsernameTakenResponse:
    type: object
    required:
      - isTaken
    properties:
      isTaken:
        description: Boolean response to whether username is already taken.
        type: boolean
    example:
      isTaken: false

  ContactEmailTakenResponse:
    type: object
    required:
      - isTaken
    properties:
      isTaken:
        description: Boolean response to whether contact email is already taken.
        type: boolean
    example:
      isTaken: false

  WorkspaceResponse:
    type: object
    required:
      - workspace
      - accessLevel
    properties:
      workspace:
        $ref: '#/definitions/Workspace'
      accessLevel:
        $ref: '#/definitions/WorkspaceAccessLevel'

  IdVerificationListResponse:
    type: object
    required:
      - profileList
    properties:
      profileList:
        type: "array"
        items:
          $ref: "#/definitions/Profile"

  AuthDomainRequest:
    type: object
    required:
      - email
    properties:
      email:
        type: string

  AuditBigQueryResponse:
    type: object
    properties:
      numQueryIssues:
        type: integer
        format: int32
        description: >
          Number of queries issues against the Curated data repository which are
          flagged as possible audit issues. See logs/alerts for details.

  CheckClustersResponse:
    type: object
    properties:
      clusterDeletionCount:
        type: integer
        format: int32
        description: >
          Number of clusters deleted during the check.

  User:
    type: object
    properties:
      email:
        description: researchallofus email address
        type: string
      givenName:
        description: the user's given name (e.g. Alice)
        type: string
      familyName:
        description: the user's family  name (e.g. Jones)
        type: string

  UserResponse:
    type: object
    properties:
      users:
        description: A list of users matching the provided search query.
        type: array
        items:
          $ref: "#/definitions/User"
      nextPageToken:
        description: >
          Pagination token that can be used in a subsequent calls to retrieve more results.
          If not set, there are no more results to retrieve.
        type: string

  RecentResourceResponse:
    type: array
    items:
      $ref: "#/definitions/RecentResource"

  RecentResource:
    type: object
    properties:
      workspaceId:
        type: integer
        format: int64
      workspaceNamespace:
        type: string
      workspaceFirecloudName:
        type: string
      permission:
        type: string
      cohort:
        $ref: "#/definitions/Cohort"
      notebook:
        $ref: '#/definitions/FileDetail'
      conceptSet:
        $ref: '#/definitions/ConceptSet'
      modifiedTime:
        type: string

  RecentResourceRequest:
      type: object
      properties:
        notebookName:
          type: string

